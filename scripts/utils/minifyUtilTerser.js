import fs from"fs";import{minify}from"terser";export async function minifyWithTerser(e,s){const o=await fs.promises.readFile(e,"utf8"),a={module:!0,toplevel:!0,compress:{ecma:2020,module:!0,toplevel:!0,passes:s.maxOptimize?3:1,keep_fnames:s.keepFunctionNames,pure_getters:!0,dead_code:!0,unused:!0,properties:!0,drop_debugger:!0,arguments:!0,booleans_as_integers:!1,hoist_funs:!0,hoist_props:!0,hoist_vars:!0,join_vars:!0,negate_iife:!0,reduce_vars:!0,collapse_vars:!0,inline:3,evaluate:!0,pure_funcs:["console.log","console.debug"],drop_console:!1},mangle:{module:!0,toplevel:!0,keep_fnames:s.keepFunctionNames,properties:!!s.maxOptimize&&{reserved:["_events","_eventsCount","_maxListeners","domain"],regex:/^_/}},format:{ecma:2020,comments:!s.removeComments,ascii_only:!0,beautify:!1},sourceMap:s.sourceMaps,parse:{module:!0,ecma:2020}},i=await minify(o,a);await fs.promises.writeFile(e,i.code),i.map&&s.sourceMaps&&await fs.promises.writeFile(`${e}.map`,i.map)}