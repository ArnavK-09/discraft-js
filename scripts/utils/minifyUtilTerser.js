import fs from"fs";import{minify}from"terser";export async function minifyWithTerser(filePath,config){const code=await fs.promises.readFile(filePath,"utf8"),terserOptions={module:!0,toplevel:!0,compress:{ecma:2020,module:!0,toplevel:!0,passes:config.maxOptimize?3:1,keep_fnames:!!config.standalone||config.keepFunctionNames,pure_getters:!0,dead_code:!0,unused:!0,properties:!config.standalone,drop_debugger:!config.standalone,arguments:!config.standalone,booleans_as_integers:!1,hoist_funs:!config.standalone,hoist_props:!config.standalone,hoist_vars:!config.standalone,join_vars:!0,negate_iife:!config.standalone,reduce_vars:!0,collapse_vars:!config.standalone,inline:config.standalone?1:3,evaluate:!0,pure_funcs:["console.log","console.debug"],drop_console:!1,sequences:!0,unsafe_math:!1,unsafe_methods:!1,unsafe_proto:!1,unsafe_regexp:!1,unsafe_undefined:!1},mangle:config.standalone?{module:!0,toplevel:!1,keep_fnames:!0,properties:!1}:{module:!0,toplevel:!0,keep_fnames:config.keepFunctionNames,properties:!!config.maxOptimize&&{reserved:["_events","_eventsCount","_maxListeners","domain"],regex:/^_/}},format:{ecma:2020,comments:!config.removeComments,ascii_only:!0,beautify:!1,indent_level:0,wrap_iife:!1,preserve_annotations:!0,max_line_len:!1},sourceMap:config.sourceMaps,ie8:!1,safari10:!1},result=await minify(code,terserOptions);if(result.error)throw result.error;await fs.promises.writeFile(filePath,result.code),result.map&&config.sourceMaps&&await fs.promises.writeFile(filePath+".map",result.map)}