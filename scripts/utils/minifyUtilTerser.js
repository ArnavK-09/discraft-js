import fs from"fs";import{minify}from"terser";export async function minifyWithTerser(e,a){const s=await fs.promises.readFile(e,"utf8"),n={module:!0,toplevel:!0,compress:{ecma:2020,module:!0,toplevel:!0,passes:a.standalone?1:a.maxOptimize?3:1,keep_fnames:!!a.standalone||a.keepFunctionNames,pure_getters:!0,dead_code:!0,unused:!0,properties:!a.standalone,drop_debugger:!a.standalone,arguments:!a.standalone,booleans_as_integers:!1,hoist_funs:!a.standalone,hoist_props:!a.standalone,hoist_vars:!a.standalone,join_vars:!0,negate_iife:!a.standalone,reduce_vars:!0,collapse_vars:!a.standalone,inline:a.standalone?0:3,evaluate:!0,pure_funcs:["console.log","console.debug"],drop_console:!1,sequences:!0,unsafe_math:!1,unsafe_methods:!1,unsafe_proto:!1,unsafe_regexp:!1,unsafe_undefined:!1},mangle:a.standalone?{module:!0,toplevel:!1,keep_fnames:!0,properties:!1}:{module:!0,toplevel:!0,keep_fnames:a.keepFunctionNames,properties:!!a.maxOptimize&&{reserved:["_events","_eventsCount","_maxListeners","domain"],regex:/^_/}},format:{ecma:2020,comments:!!a.standalone||!a.removeComments,ascii_only:!0,beautify:a.standalone,indent_level:a.standalone?2:0,wrap_iife:!1,preserve_annotations:!0,max_line_len:!!a.standalone&&120},sourceMap:!!a.standalone||a.sourceMaps,ie8:!1,safari10:!1},o=await minify(s,n);if(o.error)throw o.error;await fs.promises.writeFile(e,o.code),o.map&&(a.standalone||a.sourceMaps)&&await fs.promises.writeFile(e+".map",o.map)}