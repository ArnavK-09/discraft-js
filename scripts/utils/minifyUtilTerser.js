import fs from"fs";import{minify}from"terser";export async function minifyWithTerser(e,s){const a=await fs.promises.readFile(e,"utf8"),n={module:!0,toplevel:!0,compress:{ecma:2020,module:!0,toplevel:!0,passes:s.maxOptimize?3:1,keep_fnames:!!s.standalone||s.keepFunctionNames,pure_getters:!0,dead_code:!0,unused:!0,properties:!s.standalone,drop_debugger:!s.standalone,arguments:!s.standalone,booleans_as_integers:!1,hoist_funs:!s.standalone,hoist_props:!s.standalone,hoist_vars:!s.standalone,join_vars:!0,negate_iife:!s.standalone,reduce_vars:!0,collapse_vars:!s.standalone,inline:s.standalone?1:3,evaluate:!0,pure_funcs:["console.log","console.debug"],drop_console:!1,sequences:!0,unsafe_math:!1,unsafe_methods:!1,unsafe_proto:!1,unsafe_regexp:!1,unsafe_undefined:!1},mangle:s.standalone?{module:!0,toplevel:!1,keep_fnames:!0,properties:!1}:{module:!0,toplevel:!0,keep_fnames:s.keepFunctionNames,properties:!!s.maxOptimize&&{reserved:["_events","_eventsCount","_maxListeners","domain"],regex:/^_/}},format:{ecma:2020,comments:!s.removeComments,ascii_only:!0,beautify:!1,indent_level:0,wrap_iife:!1,preserve_annotations:!0,max_line_len:!1},sourceMap:s.sourceMaps,ie8:!1,safari10:!1},o=await minify(a,n);if(o.error)throw o.error;await fs.promises.writeFile(e,o.code),o.map&&s.sourceMaps&&await fs.promises.writeFile(e+".map",o.map)}