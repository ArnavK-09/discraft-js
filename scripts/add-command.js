import fs from"fs";import path from"path";import inquirer from"inquirer";import{success,error}from"../common/utils/logger.js";async function generateCommand(){const e=await inquirer.prompt([{type:"input",name:"name",message:"Command name:",validate:e=>!!/^[a-z0-9-]+$/.test(e)||"Command name must be lowercase and may only contain letters, numbers, and dashes"},{type:"input",name:"description",message:"Command description:",validate:e=>e.length>0}]),n=await inquirer.prompt([{type:"checkbox",name:"features",message:"Select command features:",choices:[{name:"Enable response caching (improves performance for expensive operations)",value:"cacheable",checked:!1},{name:"Use deferred response (for commands that take longer than 3 seconds)",value:"deferred",checked:!1},{name:"Make responses ephemeral (only visible to the command user)",value:"ephemeral",checked:!1},{name:"Add permission requirements",value:"permissions",checked:!1}]}]);e.features=n.features;const a=[];if((await inquirer.prompt([{type:"confirm",name:"hasOptions",message:"Would you like to add command options/arguments? (e.g., /command <user> <reason>)",default:!1}])).hasOptions){console.log("\nLet's add some options to your command. For each option, you'll need to specify:"),console.log("1. The type of data it accepts (string, number, user, etc.)"),console.log('2. The name of the option (e.g., "user" in /ban <user>)'),console.log("3. A description of what the option does\n");let e=!0;for(;e;){const n=await inquirer.prompt([{type:"list",name:"type",message:"What type of data should this option accept?",choices:[{name:"String (text)",value:"String"},{name:"Integer (whole number)",value:"Integer"},{name:"Number (decimal number)",value:"Number"},{name:"Boolean (true/false)",value:"Boolean"},{name:"User (Discord user)",value:"User"},{name:"Channel (Discord channel)",value:"Channel"},{name:"Role (Discord role)",value:"Role"},{name:"Mentionable (user or role)",value:"Mentionable"},{name:"Attachment (file)",value:"Attachment"}]},{type:"input",name:"name",message:'Option name (e.g., "user", "reason", "amount"):',validate:e=>!!/^[a-z0-9-]+$/.test(e)||"Option name must be lowercase and may only contain letters, numbers, and dashes"},{type:"input",name:"description",message:'Option description (e.g., "The user to ban", "Reason for the action"):',validate:e=>e.length>0},{type:"confirm",name:"required",message:"Is this option required?",default:!1}]);a.push({type:n.type.toLowerCase(),name:n.name,description:n.description,required:n.required});const{addAnother:s}=await inquirer.prompt([{type:"confirm",name:"addAnother",message:"Would you like to add another option?",default:!1}]);s||(e=!1)}}let s=[];if(e.features.includes("permissions")){console.log("\nSelect the permissions required to use this command:"),console.log("(Use space to select/deselect, arrow keys to move, enter to confirm)\n");s=(await inquirer.prompt([{type:"checkbox",name:"permissions",message:"Required permissions:",choices:[{name:"Administrator - Full access to all commands",value:"Administrator"},{name:"Manage Server - Edit server settings",value:"ManageGuild"},{name:"Manage Messages - Delete/pin messages",value:"ManageMessages"},{name:"Manage Channels - Edit channel settings",value:"ManageChannels"},{name:"Kick Members - Remove members from server",value:"KickMembers"},{name:"Ban Members - Permanently remove members",value:"BanMembers"},{name:"Send Messages - Write in text channels",value:"SendMessages"},{name:"Embed Links - Send embedded content",value:"EmbedLinks"},{name:"Attach Files - Upload files",value:"AttachFiles"},{name:"Read Message History - View old messages",value:"ReadMessageHistory"},{name:"Mention Everyone - Use @everyone/@here",value:"MentionEveryone"}]}])).permissions}let t="import { SlashCommandBuilder";s.length>0&&(t+=", PermissionFlagsBits"),t+=" } from 'discord.js';\n",e.features.includes("cacheable")&&(t+="import { commandCache } from '../utils/commandCache.js';\n\n",t+=`// Set command-specific cache settings\ncommandCache.setCommandSettings('${e.name}', {\n  ttl: 60000, // Cache results for 1 minute\n});\n\n`),t+="export default {\n",t+="  data: new SlashCommandBuilder()\n",t+=`    .setName('${e.name}')\n`,t+=`    .setDescription('${e.description}')\n`,a.length>0&&a.forEach((e=>{t+=`    .add${e.type.charAt(0).toUpperCase()+e.type.slice(1)}Option(option =>\n`,t+="      option\n",t+=`        .setName('${e.name}')\n`,t+=`        .setDescription('${e.description}')\n`,t+=`        .setRequired(${e.required})\n`,t+="    )\n"})),s.length>0&&s.forEach((e=>{t+=`    .setDefaultMemberPermissions(PermissionFlagsBits.${e})\n`})),t+="  ,\n\n",e.features.includes("cacheable")&&(t+="  cacheable: true,\n\n"),t+="  async execute(interaction) {\n",e.features.includes("deferred")&&(t+=`    await interaction.deferReply(${e.features.includes("ephemeral")?"{ ephemeral: true }":""});\n\n`),a.length>0&&(t+="    // Get command options\n",a.forEach((e=>{t+=`    const ${e.name} = interaction.options.get${e.type.charAt(0).toUpperCase()+e.type.slice(1)}('${e.name}');\n`})),t+="\n"),t+="    // TODO: Add your command logic here\n\n",e.features.includes("deferred")?t+=`    await interaction.editReply({ content: 'Command executed!' ${e.features.includes("ephemeral")?", ephemeral: true":""} });\n`:t+=`    await interaction.reply({ content: 'Command executed!' ${e.features.includes("ephemeral")?", ephemeral: true":""} });\n`,t+="  },\n",t+="};\n";const o=process.cwd(),r=path.join(o,"src","commands");fs.existsSync(r)||fs.mkdirSync(r,{recursive:!0});const i=path.join(r,`${e.name}.js`);return fs.writeFileSync(i,t),success(`Command ${e.name} created successfully at ${i}`),{name:e.name,path:i,features:e.features,options:a}}generateCommand().catch((e=>{error("Error creating command:",e),process.exit(1)}));